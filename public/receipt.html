<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Receipt</title>
    <style>
      body {
        text-align: center;
        font-family: "Courier New", Courier, monospace;
      }
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td,
      th {
        border: 1.5px solid #dddddd;
        text-align: left;
        padding: 8px;
      }
    </style>
  </head>
  <body onload="generateTable()">
    <div>
      <h2 id="storeName"></h2>
      <h4 id="address"></h4>
      <h5 id="date"></h5>
      <h5 id="time"></h5>
      <h5>Seller: <span id="seller"></span></h5>
      <table>
        <thead>
          <th>Quantity</th>
          <th>Name</th>
          <th>Unit price</th>
          <th>Total</th>
        </thead>
        <tbody></tbody>
      </table>
      <h3>Total TTC DA: <span id="total"></span></h3>
    </div>

    <script>
      let receipt = JSON.parse(localStorage.getItem("receipt"));
      let settings = JSON.parse(localStorage.getItem("settings"));
      let products = JSON.parse(receipt.products);
      let table = document.querySelector("table");
      let tableBody = document.querySelector("tbody");
      let total = document.getElementById("total");
      let totalPrice = 0;
      let newArr = [];

      let storeName = document.getElementById("storeName");
      let seller = document.getElementById("seller");
      let address = document.getElementById("address");
      let date = document.getElementById("date");
      let time = document.getElementById("time");

      function generateTable() {
        let sellTime = new Date(receipt.date);

        seller.innerText = JSON.parse(
          localStorage.getItem("user-info")
        ).userName;

        storeName.innerText = settings[0].name;
        address.innerText = settings[0].address;
        date.innerText = sellTime.toDateString();
        time.innerText = `${sellTime.getHours()}:${sellTime.getMinutes()}`;
        products.forEach((el) => {
          let item = {
            name: el.product.name,
            price: el.product.Sprice.toFixed(2),
            qte: el.quantity,
            total: (el.quantity * el.product.Sprice).toFixed(2),
          };
          newArr.push(item);
        });
        newArr.forEach((el) => {
          let newRow = document.createElement("tr");
          Object.values(el).forEach((value) => {
            let cell = document.createElement("td");
            cell.innerText = value;
            newRow.appendChild(cell);
          });
          tableBody.appendChild(newRow);
        });
        total.innerText = receipt.totalS.toFixed(2);
        window.print();
      }
    </script>
  </body>
</html>
